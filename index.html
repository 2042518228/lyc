<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>表情反应</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <link rel="stylesheet" href="styles.css">
 
</head>
<body>
    <!-- 音效元素 -->
    <audio id="likeSound" src="./sounds/dislike.wav" preload="auto"></audio>
    <audio id="dislikeSound" src="./sounds/dislike.wav" preload="auto"></audio>
    <!-- 背景音乐 -->
    <audio id="bgMusic" src="./sounds/background_music.mp3" loop preload="auto"></audio>
    
    <div class="face-container">
        <div class="love-text">李弈辰超级可爱！</div>
        <div class="face" id="face">
            <div class="blush left"></div>
            <div class="blush right"></div>
            <div class="eyes">
                <div class="eye" id="leftEye"></div>
                <div class="eye" id="rightEye"></div>
            </div>
            <div class="mouth" id="mouth"></div>
            <div class="particles-container"></div>
        </div>
    </div>

    <div class="buttons">
        <button id="like">李弈辰可爱</button>
        <button id="dislike">李弈辰不可爱</button>
    </div>

    <script>
        window.addEventListener('load', function() {
            // 浏览器适用
            var contextClass = window.AudioContext || window.webkitAudioContext || window.mozAudioContext || window.msAudioContext;
            try {
                var context = new contextClass();
                var source = null;
                var audioBuffer = null;

                function stopSound() {
                    if (source) {
                        source.stop(0); // 立即停止
                    }
                }

                function playSound() {
                    source = context.createBufferSource();
                    source.buffer = audioBuffer;
                    source.loop = true;
                    source.connect(context.destination);
                    source.start(0); // 立即播放    
                }

                function initSound(arrayBuffer) {
                    context.decodeAudioData(arrayBuffer, function(buffer) { // 解码成功时的回调函数
                        audioBuffer = buffer;
                        playSound();
                    }, function(e) { // 解码出错时的回调函数
                        console.log('404', e);
                    });
                }

                function loadAudioFile(url) {
                    var xhr = new XMLHttpRequest(); // 通过XHR下载音频文件
                    xhr.open('GET', url, true);
                    xhr.responseType = 'arraybuffer';
                    xhr.onload = function(e) { // 下载完成
                        initSound(this.response);
                    };
                    xhr.send();
                }

                // 这里用来存储背景音乐的路径
                loadAudioFile('./sounds/background_music.mp3');
            } catch (e) {
                console.log('无法找到音乐！');
            }
        });
    </script>
    <script src="script.js"></script>
</body>
</html>
</body>
</html>
